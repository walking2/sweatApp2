/*
 * jquery.popupForm
 * https://elohr.me/
 *
 * Copyright (c) 2014 elohr
 * Licensed under the MIT license.
 */
function PopupForm(t,e){"use strict";var n={previousOverlay:null,overlay:window.jQuery("<div/>",{"class":"plugin-overlay popup-form-overlay"}),popup:window.jQuery("<div/>",{"class":"popup-form-popup"}),closeButton:window.jQuery("<img/>",{"class":"popup-form-close-icon",src:"css/close.png"}),formTitle:window.jQuery("<h3/>"),init:function(){n.closeButton.click(n.close),n.overlay.click(n.close),n.popup.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",".steps-container-popup",n.transitionEnded),$(t).children(".steps-popup div").click(n.stepDivClicked),$(t).find(".next-button-popup").click(n.nextButtonClicked),$(t).on("keydown","input, button",n.keyDownInput),e.formTitle&&(n.formTitle=n.formTitle.text(e.formTitle),n.popup.prepend(n.formTitle)),n.popup.append(n.closeButton,[t]),$(t).show(),e.customzindex&&(n.popup.css("z-index",e.customzindex+1),n.overlay.css("z-index",e.customzindex)),$(document.body).append(n.popup,[n.overlay]),e.initialized()},open:function(i){i.preventDefault(),e.opening(),n.previousOverlay=$(".plugin-overlay:visible"),n.previousOverlay.hide(),n.overlay.show(),n.popup.addClass("plugin-fade"),n.adjustStepContainerHeight(),$(t).children(".steps-container-popup:first").children(".step-one-container-popup:first").children("input:first").focus(),e.opened()},close:function(){e.closing(),n.overlay.hide(),n.previousOverlay.show(),n.popup.removeClass("plugin-fade"),n.resetForm(),e.closed()},submit:function(i){i.preventDefault(),e.submitting()&&($.post($(t).attr("action"),$(t).serialize(),function(t){e.submitSuccess(t)}).fail(function(t){e.submitFailed(t)}),e.submitted(),n.close())},centerPopup:function(){n.popup.css({left:($(window).width()-n.popup.outerWidth())/2,top:$(e.openPopupButton).offset().top+24})},adjustStepContainerHeight:function(){var e=n.getCurrentStep(),i=$(t).children(".steps-container-popup:first");i.height(1===e?i.children(".step-one-container-popup:first").height()+"px":2===e?i.children(".step-two-container-popup:first").height()+"px":i.children(".step-three-container-popup:first").height()+"px"),n.centerPopup()},getCurrentStep:function(){var e=$(t).children(".steps-popup:first").children(".active-step-popup:first");return e.hasClass("step-one-popup")?1:e.hasClass("step-two-popup")?2:3},moveTo:function(t,e){var i=t.prev();t.css("margin-left",-32+-414*(e-1)+"px"),i.children(".active-step-popup").removeClass("active-step-popup"),1===e?i.children(".step-one-popup").addClass("active-step-popup"):2===e?i.children(".step-two-popup").addClass("active-step-popup"):3===e&&i.children(".step-three-popup").addClass("active-step-popup"),n.adjustStepContainerHeight()},transitionEnded:function(){1===n.getCurrentStep()?$(this).children(".step-one-container-popup").children("input:first").focus():2===n.getCurrentStep()?$(this).children(".step-two-container-popup").children("input:first").focus():$(this).children(".step-three-container-popup").children("input:first").focus()},stepDivClicked:function(){var t=$(this),i=1,o=!0;t.hasClass("step-two-popup")?i=2:t.hasClass("step-three-popup")&&(i=3),1===n.getCurrentStep()&&i>1?o=e.validateStepOne(t.parent().next().children(".step-one-container-popup")):2===n.getCurrentStep()&&i>2&&(o=e.validateStepTwo(t.parent().next().children(".step-two-container-popup"))),o&&n.moveTo(t.parent().next(),i)},nextButtonClicked:function(){var t,i,o=$(this).parent();i=1===n.getCurrentStep()?e.validateStepOne(o):e.validateStepTwo(o),i&&(t=o.parent(),n.moveTo(t,1===n.getCurrentStep()?2:3))},resetForm:function(){var e=$(t).children(".steps-container-popup:first");e.children().each(function(){$(this).children("input, textarea").each(function(){$(this).val("")})}),e.find(".selectable").each(function(){$(this).data("Selectable").removeSelection()}),n.moveTo(e,1)},keyDownInput:function(t){var e;13==t.which?(e=$(this).siblings(":last"),e.hasClass("next-button-popup")&&(t.preventDefault(),e.click())):9==t.which&&0===$(this).nextAll("input, .selectable").length&&(e=$(this).siblings(":last"),e.hasClass("next-button-popup")&&(t.preventDefault(),e.click()))}};e=e||{},e.formTitle=e.formTitle,e.openPopupButton=e.openPopupButton,e.customzindex=e.customzindex,e.initialized=e.initialized||function(){},e.opening=e.opening||function(){},e.opened=e.opened||function(){},e.closing=e.closing||function(){},e.closed=e.closed||function(){},e.submitting=e.submitting||function(){return!0},e.submitted=e.submitted||function(){},e.submitFailed=e.submitFailed||function(){},e.submitSuccess=e.submitSuccess||function(){},e.validateStepOne=e.validateStepOne||function(){},e.validateStepTwo=e.validateStepTwo||function(){};var i={handleEvent:function(t){switch(t.type){case"click":this.click(t)}},click:function(t){n.open(t)}};return n.init(),e.openPopupButton.addEventListener("click",i,!1),$(t).submit(n.submit),{kill:function(){},submit:n.submit,reset:n.resetForm,validate:function(){},open:n.open,close:n.close,adjustStepContainerHeight:n.adjustStepContainerHeight,getCurrentStep:n.getCurrentStep,moveTo:n.moveTo}}window.jQuery&&!function(t){var e="PopupForm",n={init:function(n){return this.each(function(){var i=t(this),o=i.data(e);o||i.data(e,new PopupForm(t(this)[0],n))})}};t.fn[e]=function(i){return n[i]?n[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error("Method "+i+" does not exist in jQuery."+e):n.init.apply(this,arguments)}}(window.jQuery);